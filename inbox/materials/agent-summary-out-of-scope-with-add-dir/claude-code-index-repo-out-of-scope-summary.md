# Claude Code 폴더 접근/스코프 제어 논의 요약

## 발단(문제의식)
- Claude Code를 실행할 때 특정 폴더(예: secrets, datasets 등)는 기본적으로 절대 읽지 않게 하고, 사용자가 명시적으로 “봐도 된다”고 지시할 때만 제한적으로 참조시키고 싶었다.

## 탐색한 옵션과 관찰
### 1) 설정 기반 차단(deny) + 규칙 문서(CLAUDE.md)
- `.claude/settings.json`(또는 `.claude/settings.local.json`)에서 `permissions.deny`로 특정 경로의 읽기(Read) 등을 막는 방식이 가능하다는 점을 확인했다.
- `CLAUDE.md`에 “기본적으로 특정 폴더는 읽지 말라, 지시가 있을 때만 보라” 같은 운영 규칙을 두어 행동 가이드를 강화할 수 있다.
- 다만 ‘완전 차단 + 예외 시에만 열람’이 항상 100% 보장되는 하드 보안 모델로 보기에는 한계가 있어, 중요한 비밀은 추가적인 방어가 필요하다는 결론으로 기울었다.

### 2) 민감 폴더를 루트 밖으로 분리
- ‘실행 루트(작업 디렉터리) 기준’으로 도구가 파일을 탐색/읽는 특성상, 민감 폴더를 프로젝트 루트 바깥으로 옮겨두는 것이 실무적으로 가장 강력한 방어책 중 하나로 정리되었다.
- 즉, “애초에 스코프 밖에 두는 구조적 분리”가 설정 실수나 예외 케이스를 줄이는 데 유리하다.

### 3) 루트 밖 다른 Git repo를 통째로 읽고 분석 가능한가?
- 가능하다.
- 다만 기본 루트 밖의 repo를 ‘동일한 수준의 탐색 대상’으로 취급하려면, 해당 경로를 추가 작업 디렉터리로 등록하는 `/add-dir` 또는 시작 시 `--add-dir` 같은 메커니즘이 핵심이다.

## 핵심 쟁점 정리
### “루트 안을 파악” vs “루트 밖 경로를 지정해 파악”은 동일한가?
- 동일한 탐색 방식(`bash`, `grep`, `find` 등)을 쓰더라도, 접근 가능한 **작업 디렉터리 스코프**가 다르기 때문에 ‘동일하다’고 보긴 어렵다.
- 루트 밖 repo를 안정적으로 분석 대상으로 포함하려면 보통 `/add-dir`로 워크스페이스에 넣는 절차가 필요하다는 판단이 섰다.

### Claude Code가 알아서 add-dir 하기도 하나?
- 기본적으로는 임의로 자동 확장하기보다는, 바깥 경로가 필요하면 사용자가 `/add-dir`(또는 `--add-dir`)로 명시적으로 추가하는 흐름이 중심이다.

### “동적으로 add-dir 후 remove-dir” 자동화가 가능한가?
- 동적 추가(`/add-dir`)는 가능하다.
- 그러나 대화에서 확인한 바에 따르면, 디렉터리를 다시 ‘제거’하는 전용 `/remove-dir` 같은 기능은 명확히 보장되지 않아(기능 요청/이슈가 존재), ‘열었다가 닫는’ UX를 완전히 자동화하기는 제약이 있다.
- 현실적 대안은 세션 단위로 운영(분석 세션을 별도로 열고, 끝나면 세션 종료/재시작으로 스코프를 되돌리는 방식)이다.

## 의사결정(권장 방향)
- **보안/노출 최소화가 1순위**라면:
  - 민감 폴더는 프로젝트 루트 밖으로 분리(구조적 방어).
  - 루트 내부에도 실수 유입을 대비해 `permissions.deny` + `CLAUDE.md` 규칙을 겹쳐 적용(방어 심화).
- **멀티 repo 분석/작업이 필요**하다면:
  - 해당 repo를 `/add-dir`로 추가한 뒤, 필요한 범위만 최소로 읽도록 지시.
  - ‘닫기(remove)’는 기능 제약을 고려해 세션 운영으로 해결.

## subagent/skill 아이디어(초안)
- 목표: “외부 repo를 잠깐만 열어 분석하고, 본 작업 컨텍스트로 복귀”를 자동화.
- 제약: remove-dir이 불확실하므로, 아래 중 하나로 설계.
  1) **세션 분리형**: subagent가 `/add-dir`→분석→결과 요약을 남기고 세션 종료(또는 새 세션 유도).
  2) **최소 노출형**: add-dir 후에도 파일을 무차별 탐색하지 않고, 사용자가 준 파일 목록/경로만 읽도록 강제 규칙을 함께 적용.

---
작성 시각: 2025-12-31 (KST)
